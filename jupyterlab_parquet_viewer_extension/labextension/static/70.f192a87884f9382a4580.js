"use strict";(self.webpackChunkjupyterlab_parquet_viewer_extension=self.webpackChunkjupyterlab_parquet_viewer_extension||[]).push([[70],{70:(t,e,a)=>{a.r(e),a.d(e,{default:()=>c});var s=a(561),i=a(256),r=a(297),n=a(860);async function o(t="",e={}){const a=n.ServerConnection.makeSettings(),s=r.URLExt.join(a.baseUrl,"jupyterlab-parquet-viewer-extension",t);let i;try{i=await n.ServerConnection.makeRequest(s,e,a)}catch(t){throw new n.ServerConnection.NetworkError(t)}let o=await i.text();if(o.length>0)try{o=JSON.parse(o)}catch(t){console.log("Not a JSON response body.",i)}if(!i.ok)throw new n.ServerConnection.ResponseError(i,o.message||o);return o}class l extends i.Widget{constructor(t){super(),this._columns=[],this._data=[],this._totalRows=0,this._currentOffset=0,this._limit=500,this._loading=!1,this._hasMore=!0,this._filters={},this._sortBy=null,this._sortOrder="asc",this._fileSize=0,this._filePath=t,this.addClass("jp-ParquetViewer"),this._tableContainer=document.createElement("div"),this._tableContainer.className="jp-ParquetViewer-container",this._table=document.createElement("table"),this._table.className="jp-ParquetViewer-table",this._thead=document.createElement("thead"),this._thead.className="jp-ParquetViewer-thead",this._tbody=document.createElement("tbody"),this._tbody.className="jp-ParquetViewer-tbody",this._filterRow=document.createElement("tr"),this._filterRow.className="jp-ParquetViewer-filterRow",this._headerRow=document.createElement("tr"),this._headerRow.className="jp-ParquetViewer-headerRow",this._thead.appendChild(this._filterRow),this._thead.appendChild(this._headerRow),this._table.appendChild(this._thead),this._table.appendChild(this._tbody),this._tableContainer.appendChild(this._table),this._statusBar=document.createElement("div"),this._statusBar.className="jp-ParquetViewer-statusBar",this._statusLeft=document.createElement("div"),this._statusLeft.className="jp-ParquetViewer-statusLeft",this._statusRight=document.createElement("div"),this._statusRight.className="jp-ParquetViewer-statusRight",this._statusBar.appendChild(this._statusLeft),this._statusBar.appendChild(this._statusRight),this._tableContainer.appendChild(this._statusBar),this.node.appendChild(this._tableContainer),this._tableContainer.addEventListener("scroll",()=>{this._onScroll()}),this._initialize()}async _initialize(){try{await this._loadMetadata(),await this._loadData(!0)}catch(t){this._showError(`Failed to load file: ${t}`)}}async _loadMetadata(){const t=await o("metadata",{method:"POST",body:JSON.stringify({path:this._filePath})});this._columns=t.columns,this._totalRows=t.totalRows,this._fileSize=t.fileSize||0,this._renderHeaders(),this._updateStatusBar()}async _loadData(t=!1){if(!this._loading){this._loading=!0,this._updateStatusBar("Loading...");try{t&&(this._currentOffset=0,this._data=[],this._tbody.innerHTML="");const e=await o("data",{method:"POST",body:JSON.stringify({path:this._filePath,offset:this._currentOffset,limit:this._limit,filters:this._filters,sortBy:this._sortBy,sortOrder:this._sortOrder})});this._data=this._data.concat(e.data),this._hasMore=e.hasMore,this._currentOffset+=e.data.length,t&&(this._totalRows=e.totalRows),this._renderData(e.data),this._updateStatusBar()}catch(t){this._showError(`Failed to load data: ${t}`)}finally{this._loading=!1}}}_renderHeaders(){this._filterRow.innerHTML="",this._headerRow.innerHTML="",this._columns.forEach(t=>{const e=document.createElement("th");e.className="jp-ParquetViewer-filterCell";const a=document.createElement("input");a.type="text",a.className="jp-ParquetViewer-filterInput",a.placeholder=this._getFilterPlaceholder(t.type),a.dataset.columnName=t.name,a.dataset.columnType=t.type,a.addEventListener("keyup",e=>{"Enter"===e.key&&this._applyFilter(t.name,a.value,t.type)}),e.appendChild(a),this._filterRow.appendChild(e);const s=document.createElement("th");s.className="jp-ParquetViewer-headerCell",s.style.cursor="pointer",s.dataset.columnName=t.name,s.addEventListener("click",()=>{this._toggleSort(t.name)});const i=document.createElement("div");i.className="jp-ParquetViewer-headerContent";const r=document.createElement("div");r.className="jp-ParquetViewer-columnName",r.textContent=t.name;const n=document.createElement("div");n.className="jp-ParquetViewer-columnType",n.textContent=this._simplifyType(t.type);const o=document.createElement("span");o.className="jp-ParquetViewer-sortIndicator",o.textContent="",i.appendChild(r),i.appendChild(n),s.appendChild(i),s.appendChild(o),this._headerRow.appendChild(s)})}_renderData(t){t.forEach(t=>{const e=document.createElement("tr");e.className="jp-ParquetViewer-row",this._columns.forEach(a=>{const s=document.createElement("td");s.className="jp-ParquetViewer-cell";const i=t[a.name];s.textContent=null!=i?String(i):"",e.appendChild(s)}),this._tbody.appendChild(e)})}_applyFilter(t,e,a){if(e.trim())if(this._isNumericType(a)){const a=e.match(/^([><=]+)?\s*(.+)$/);if(a){const e=a[1]||"=",s=a[2].trim();this._filters[t]={type:"number",value:s,operator:e}}}else this._filters[t]={type:"text",value:e};else delete this._filters[t];this._loadData(!0)}_simplifyType(t){const e=t.toLowerCase();return e.includes("date32")||e.includes("date64")?"date":e.includes("timestamp")?"datetime":e.match(/^u?int(8|16|32|64)$/)?"int":e.match(/^(float|double)(16|32|64)?$/)?"float":e.includes("decimal")?"decimal":"bool"===e?"boolean":"string"===e||"utf8"===e||"large_string"===e||"large_utf8"===e?"string":"binary"===e||"large_binary"===e?"binary":e.startsWith("list")?"list":e.startsWith("struct")?"struct":t}_isNumericType(t){return["int","float","double","decimal","int8","int16","int32","int64","uint8","uint16","uint32","uint64"].some(e=>t.toLowerCase().includes(e))}_getFilterPlaceholder(t){return this._isNumericType(t)?"=, >, <, >=, <=":"Filter text..."}_onScroll(){const t=this._tableContainer;t.scrollTop+t.clientHeight>=t.scrollHeight-200&&this._hasMore&&!this._loading&&this._loadData(!1)}_toggleSort(t){this._sortBy===t?"asc"===this._sortOrder?this._sortOrder="desc":"desc"===this._sortOrder&&(this._sortBy=null,this._sortOrder="asc"):(this._sortBy=t,this._sortOrder="asc"),this._updateSortIndicators(),this._loadData(!0)}_updateSortIndicators(){this._headerRow.querySelectorAll("th").forEach(t=>{const e=t.dataset.columnName,a=t.querySelector(".jp-ParquetViewer-sortIndicator");e===this._sortBy?a.textContent="asc"===this._sortOrder?" ▲":" ▼":a.textContent=""})}_clearFilters(){this._filters={},this._filterRow.querySelectorAll("input").forEach(t=>{t.value=""}),this._loadData(!0)}_formatFileSize(t){if(0===t)return"0 B";const e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB","TB"][e]}_updateStatusBar(t){if(t)this._statusLeft.textContent="",this._statusRight.textContent=t;else{const t=this._columns.length,e=this._formatFileSize(this._fileSize);this._statusLeft.textContent=`${t} columns • ${this._totalRows} rows • ${e}`;const a=Object.keys(this._filters).length;let s=`Showing ${this._data.length} of ${this._totalRows} rows`;if(a>0&&(s+=` (${a} filter${a>1?"s":""} active)`),this._statusRight.innerHTML=s,a>0){const t=document.createElement("a");t.href="#",t.className="jp-ParquetViewer-clearFilters",t.textContent="Clear filters",t.addEventListener("click",t=>{t.preventDefault(),this._clearFilters()}),this._statusRight.appendChild(document.createTextNode(" • ")),this._statusRight.appendChild(t)}}}_showError(t){this._tbody.innerHTML="";const e=document.createElement("tr"),a=document.createElement("td");a.colSpan=this._columns.length||1,a.className="jp-ParquetViewer-error",a.textContent=t,e.appendChild(a),this._tbody.appendChild(e)}dispose(){this._tableContainer.removeEventListener("scroll",this._onScroll),super.dispose()}}class h extends s.DocumentWidget{constructor(t){super(t)}}class d extends s.ABCWidgetFactory{createNewWidget(t){const e=new l(t.path),a=new h({content:e,context:t});return a.title.label=t.path.split("/").pop()||"Parquet File",a}}const c={id:"jupyterlab_parquet_viewer_extension:plugin",description:"Jupyterlab extension to allow simple browsing of the parquet files with basic data filtering capabilities",autoStart:!0,requires:[],activate:t=>{console.log("JupyterLab extension jupyterlab_parquet_viewer_extension is activated!");const{docRegistry:e}=t;try{e.addFileType({name:"parquet",displayName:"Parquet",extensions:[".parquet"],mimeTypes:["application/x-parquet"],iconClass:"jp-MaterialIcon jp-SpreadsheetIcon",contentType:"file",fileFormat:"base64"}),console.log("Parquet file type registered with base64 format")}catch(t){console.warn("Parquet file type already registered",t)}const a=new d({name:"Parquet Viewer",modelName:"base64",fileTypes:["parquet"],defaultFor:["parquet"],defaultRendered:["parquet"],readOnly:!0});e.addWidgetFactory(a),console.log("Parquet viewer factory registered with base64 model")}}}}]);